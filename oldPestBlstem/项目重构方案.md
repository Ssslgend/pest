# 美国白蛾预测项目重构方案

## 📁 新项目结构设计

```
pest/
├── README.md                          # 项目总说明
├── requirements.txt                   # 依赖包列表
├── setup.py                          # 项目安装配置
├── .gitignore                        # Git忽略文件
├── CLAUDE.md                         # Claude使用说明
│
├── config/                           # 配置管理
│   ├── __init__.py
│   ├── base_config.py               # 基础配置
│   ├── model_config.py              # 模型配置
│   ├── data_config.py               # 数据配置
│   └── paths_config.py              # 路径配置
│
├── src/                             # 主要源代码
│   ├── __init__.py
│   │
│   ├── data/                        # 数据处理模块
│   │   ├── __init__.py
│   │   ├── loaders/                 # 数据加载器
│   │   │   ├── __init__.py
│   │   │   ├── excel_loader.py      # Excel数据加载
│   │   │   ├── geojson_loader.py    # GeoJSON数据加载
│   │   │   └── raster_loader.py     # 栅格数据加载
│   │   ├── processors/              # 数据处理器
│   │   │   ├── __init__.py
│   │   │   ├── occurrence_processor.py  # 发病数据处理
│   │   │   ├── meteorological_processor.py  # 气象数据处理
│   │   │   └── spatial_processor.py  # 空间数据处理
│   │   ├── integrators/             # 数据整合器
│   │   │   ├── __init__.py
│   │   │   ├── county_integrator.py  # 县级数据整合
│   │   │   ├── raster_integrator.py  # 栅格数据整合
│   │   │   └── geojson_integrator.py  # GeoJSON整合
│   │   └── utils/                   # 数据工具
│   │       ├── __init__.py
│   │       ├── validation.py        # 数据验证
│   │       ├── cleaning.py          # 数据清洗
│   │       └── transformation.py    # 数据转换
│   │
│   ├── models/                      # 模型模块
│   │   ├── __init__.py
│   │   ├── base/                    # 基础模型
│   │   │   ├── __init__.py
│   │   │   ├── bilstm.py           # BiLSTM模型
│   │   │   ├── attention.py        # 注意力机制
│   │   │   └── residual.py         # 残差连接
│   │   ├── county/                  # 县级预测模型
│   │   │   ├── __init__.py
│   │   │   ├── county_model.py     # 县级模型
│   │   │   └── county_trainer.py   # 县级训练器
│   │   ├── raster/                  # 栅格预测模型
│   │   │   ├── __init__.py
│   │   │   ├── raster_model.py     # 栅格模型
│   │   │   └── raster_trainer.py   # 栅格训练器
│   │   └── utils/                   # 模型工具
│   │       ├── __init__.py
│   │       ├── metrics.py          # 评估指标
│   │       ├── losses.py           # 损失函数
│   │       └── callbacks.py        # 回调函数
│   │
│   ├── training/                    # 训练模块
│   │   ├── __init__.py
│   │   ├── trainers/                # 训练器
│   │   │   ├── __init__.py
│   │   │   ├── base_trainer.py     # 基础训练器
│   │   │   ├── county_trainer.py   # 县级训练器
│   │   │   └── raster_trainer.py   # 栅格训练器
│   │   ├── pipelines/               # 训练流水线
│   │   │   ├── __init__.py
│   │   │   ├── data_pipeline.py    # 数据流水线
│   │   │   └── train_pipeline.py   # 训练流水线
│   │   └── utils/                   # 训练工具
│   │       ├── __init__.py
│   │       ├── checkpointing.py    # 检查点管理
│   │       └── logging.py          # 日志管理
│   │
│   ├── prediction/                  # 预测模块
│   │   ├── __init__.py
│   │   ├── predictors/              # 预测器
│   │   │   ├── __init__.py
│   │   │   ├── county_predictor.py # 县级预测
│   │   │   └── raster_predictor.py # 栅格预测
│   │   ├── postprocessors/          # 后处理
│   │   │   ├── __init__.py
│   │   │   ├── smoothing.py        # 空间平滑
│   │   │   └── visualization.py    # 可视化
│   │   └── utils/                   # 预测工具
│   │       ├── __init__.py
│   │       └── io_utils.py         # 输入输出工具
│   │
│   ├── evaluation/                  # 评估模块
│   │   ├── __init__.py
│   │   ├── evaluators/              # 评估器
│   │   │   ├── __init__.py
│   │   │   ├── model_evaluator.py  # 模型评估
│   │   │   └── performance_analyzer.py  # 性能分析
│   │   ├── metrics/                 # 评估指标
│   │   │   ├── __init__.py
│   │   │   ├── classification_metrics.py  # 分类指标
│   │   │   └── regression_metrics.py     # 回归指标
│   │   └── reports/                 # 报告生成
│   │       ├── __init__.py
│   │       └── report_generator.py # 报告生成器
│   │
│   └── utils/                       # 通用工具
│       ├── __init__.py
│       ├── file_utils.py           # 文件工具
│       ├── geo_utils.py            # 地理工具
│       ├── visualization_utils.py  # 可视化工具
│       └── logging_utils.py        # 日志工具
│
├── scripts/                         # 执行脚本
│   ├── __init__.py
│   ├── data/                       # 数据处理脚本
│   │   ├── prepare_training_data.py  # 准备训练数据
│   │   ├── validate_data.py        # 数据验证
│   │   └── explore_data.py         # 数据探索
│   ├── training/                   # 训练脚本
│   │   ├── train_county_model.py   # 训练县级模型
│   │   ├── train_raster_model.py   # 训练栅格模型
│   │   └── hyperparameter_tuning.py  # 超参数调优
│   ├── prediction/                 # 预测脚本
│   │   ├── predict_county.py       # 县级预测
│   │   ├── predict_raster.py       # 栅格预测
│   │   └── batch_prediction.py     # 批量预测
│   ├── evaluation/                 # 评估脚本
│   │   ├── evaluate_model.py       # 模型评估
│   │   ├── compare_models.py       # 模型比较
│   │   └── generate_report.py      # 生成报告
│   └── visualization/              # 可视化脚本
│       ├── plot_training_curves.py # 训练曲线
│       ├── plot_predictions.py     # 预测结果
│       └── create_risk_maps.py     # 风险地图
│
├── experiments/                    # 实验和研究
│   ├── __init__.py
│   ├── ablation_studies/          # 消融实验
│   │   ├── __init__.py
│   │   ├── feature_ablation.py    # 特征消融
│   │   └── model_ablation.py      # 模型消融
│   ├── sensitivity_analysis/       # 敏感性分析
│   │   ├── __init__.py
│   │   └── parameter_sensitivity.py  # 参数敏感性
│   └── model_comparison/          # 模型比较
│       ├── __init__.py
│       └── comparative_analysis.py  # 比较分析
│
├── tests/                         # 测试代码
│   ├── __init__.py
│   ├── test_data/                # 数据测试
│   ├── test_models/              # 模型测试
│   ├── test_training/            # 训练测试
│   └── test_utils/              # 工具测试
│
├── docs/                         # 文档
│   ├── api/                     # API文档
│   ├── tutorials/               # 教程
│   ├── technical_notes/         # 技术说明
│   └── user_guide/             # 用户指南
│
├── data/                        # 数据目录
│   ├── raw/                    # 原始数据
│   │   ├── occurrence/         # 发病数据
│   │   ├── meteorological/     # 气象数据
│   │   └── geographical/       # 地理数据
│   ├── processed/              # 处理后数据
│   │   ├── training/           # 训练数据
│   │   ├── validation/         # 验证数据
│   │   └── test/              # 测试数据
│   └── external/              # 外部数据
│
├── results/                     # 结果输出
│   ├── models/                 # 训练好的模型
│   ├── predictions/            # 预测结果
│   ├── evaluations/            # 评估结果
│   ├── visualizations/         # 可视化结果
│   └── reports/               # 分析报告
│
└── archive/                     # 归档文件
    ├── old_code/               # 旧代码
    ├── deprecated_data/        # 废弃数据
    └── previous_experiments/   # 之前实验
```

## 🎯 重构原则

1. **功能分离**: 按照功能模块划分，而不是按文件类型
2. **层次清晰**: 每个模块内部有清晰的层次结构
3. **可扩展性**: 便于添加新功能和模型
4. **可维护性**: 代码组织清晰，便于维护
5. **可测试性**: 每个模块都有对应的测试

## 📋 迁移计划

1. **第一阶段**: 创建新目录结构
2. **第二阶段**: 移动核心代码文件
3. **第三阶段**: 重构和优化代码
4. **第四阶段**: 更新配置和依赖
5. **第五阶段**: 测试和验证

## 🔄 主要功能模块

### 1. 数据处理 (src/data/)
- 数据加载: Excel, GeoJSON, 栅格数据
- 数据处理: 发病数据, 气象数据, 空间数据
- 数据整合: 县级整合, 栅格整合

### 2. 模型 (src/models/)
- 基础模型: BiLSTM, 注意力机制, 残差连接
- 专用模型: 县级模型, 栅格模型

### 3. 训练 (src/training/)
- 训练器: 基础训练器, 专用训练器
- 流水线: 数据流水线, 训练流水线

### 4. 预测 (src/prediction/)
- 预测器: 县级预测, 栅格预测
- 后处理: 空间平滑, 可视化

### 5. 评估 (src/evaluation/)
- 评估器: 模型评估, 性能分析
- 指标: 分类指标, 回归指标

### 6. 工具 (src/utils/)
- 通用工具: 文件, 地理, 可视化, 日志

这个结构将使项目更加模块化、可维护和可扩展。