# 模型对比分析工具 (V2)\n\n该工具用于比较MLP、LSTM和BiLSTM三种模型的训练性能指标，生成可视化对比图表。\n\n## 主要功能\n\n- 从标准化的CSV训练日志中加载数据。\n- 生成模型验证集AUC和损失值的对比图表。\n- 生成模型性能综合指标表格。\n- 支持中文输出和显示。\n- 自动标注模型参数量估计。\n\n## 目录结构\n\n```\nmodel_comparison_v2/\n├── README.md                     # 本说明文件\n├── model_comparison.py           # 主要对比分析脚本\n├── model_logger.py              # 模型日志记录工具（需集成到训练脚本）\n├── requirements.txt              # 依赖项列表\n├── data/                         # 标准化训练日志CSV存放目录\n│   ├── mlp_training_log.csv      # (示例) MLP模型训练日志\n│   ├── lstm_training_log.csv     # (示例) LSTM模型训练日志\n│   └── bilstm_training_log.csv   # (示例) BiLSTM模型训练日志\n└── output/                       # 输出图表和分析结果\n    ├── model_auc_comparison.png  # AUC对比图\n    ├── model_loss_comparison.png # 损失对比图\n    └── model_performance_summary.csv     # 性能指标摘要表\n```\n\n## 使用方法\n\n**重要：** 此工具依赖于各个训练脚本输出标准格式的 `training_log.csv` 文件。您需要先修改训练脚本。\n\n### 1. 修改训练脚本以使用 ModelLogger\n\n在每个训练脚本（`train_mlp.py`, `train_lstm.py`, `train_raster.py`）中集成 `ModelLogger`。具体修改方法见下一步说明。\n\n### 2. 重新运行训练\n\n修改完训练脚本后，**重新运行**每个模型的训练过程。这将在各自的 `output` 目录下生成 `training_log.csv` 文件。\n\n### 3. 复制日志文件\n\n将各个模型 `output` 目录下生成的 `training_log.csv` 文件**复制**到 `model_comparison_v2/data/` 目录下，并**重命名**以区分模型（例如 `mlp_training_log.csv`, `lstm_training_log.csv`, `bilstm_training_log.csv`）。\n\n### 4. 运行对比分析\n\n进入 `model_comparison_v2` 目录并运行对比脚本：\n\n```bash\ncd model_comparison_v2\npython model_comparison.py\n```\n\n脚本会自动读取 `data` 目录下的CSV日志文件，并在 `output` 目录中生成对比图表和性能摘要表。\n\n## 如何集成 ModelLogger (示例: train_mlp.py)\n\n请在 `train_mlp.py` (以及其他训练脚本) 中进行类似修改：\n\n1.  **导入 ModelLogger:**\n\n    ```python\n    import sys\n    import os\n    # 添加 model_comparison_v2 目录到 Python 路径\n    comparison_dir = os.path.abspath(os.path.join(os.path.dirname(__file__), '..', 'model_comparison_v2'))\n    if comparison_dir not in sys.path:\n        sys.path.append(comparison_dir)\n    from model_logger import ModelLogger \n    ```\n\n2.  **移除或注释掉旧的 logging 配置。**\n\n3.  **初始化 ModelLogger:** 在 `train_model` 函数开头（或适当位置）：\n\n    ```python\n    # --- 初始化 ModelLogger --- \n    model_name = "MLP" # 或 "LSTM", "BiLSTM" \n    output_dir = CONFIG['output_dir'] # 确保config中有output_dir\n    logger = ModelLogger(model_name, output_dir, config=CONFIG)\n    ```\n\n4.  **替换日志记录:** 将脚本中所有 `logger.info(...)`, `logger.warning(...)`, `print(...)` 等替换为 `logger.log_message(...)`。\n\n5.  **记录 Epoch 开始:** 在训练循环开始处：\n\n    ```python\n    for epoch in range(start_epoch, epochs):\n        logger.start_epoch(epoch + 1) # 使用从1开始的epoch\n        # ... (原有的 epoch_start_time = time.time() 可以移除)\n    ```\n\n6.  **记录 Epoch 结束:** 在验证步骤之后，记录指标：\n\n    ```python\n    # ... (计算 epoch_loss, epoch_train_auc, val_loss, val_auc)\n    current_lr = optimizer.param_groups[0]['lr'] # 获取当前学习率\n    logger.end_epoch(\n        epoch=epoch + 1,\n        train_loss=epoch_loss,\n        train_auc=epoch_train_auc,\n        val_loss=val_loss,\n        val_auc=val_auc,\n        learning_rate=current_lr\n    )\n    # ... (原有的 history[...] append 和 logger.info 格式化输出可以移除)\n    ```\n\n7.  **记录训练结束:** 在训练循环结束后：\n\n    ```python\n    logger.finish_training()\n    # ... (原有的总时间和绘图逻辑可以移除，ModelLogger会处理)\n    ```\n\n**注意:** `train_raster.py` 的结构可能略有不同，但集成思路一致：初始化 `ModelLogger`，用 `log_message` 替换打印/日志记录，用 `start_epoch`, `end_epoch`, `finish_training` 记录训练过程的关键节点和指标。\n\n## 依赖项\n\n- Python 3.6+\n- pandas\n- matplotlib\n- seaborn\n- numpy\n\n```bash\npip install pandas matplotlib seaborn numpy\n``` 